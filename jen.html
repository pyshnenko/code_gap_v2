<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Code_Gap</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./jen/pacman.css" />
  <link rel="stylesheet" href="./jen/style.css" />
  <link rel="stylesheet" href="./jen/mobStyle.css" />
  <link rel="stylesheet" href="./jen/packman-mobile.css" />
</head>
<body>
  <!-- Навбар -->
  <nav class="navbar">
    <div style="display: inline-flex; align-items: center;">
      <img src="./jen/logo.png" alt="Логотип" class="logo" id="topLogo"/>
      <ul class="nav-links">
        <li><p id="about">О нас</p></li>
        <li><p id="courses">Курсы</p></li>
        <li><p id="team">Команда</p></li>
        <li><p id="contact">Контакты</p></li>
      </ul>
    </div>
    <div class="phoneButton">
      <p style="margin: 12px;">+7 995 757 87 46</p>
    </div>
  </nav>

  <!-- Главный экран -->
  <div class="page1" id="page1">
    <div id="mobile_logo">
      <img src="./jen/logo.png" />
      <h1>&lt;CODE_GAP&gt;</h1>
    </div>
    <div class="left_page1">
      <div class="textBlock">
        <h2>
          Академия <br> программирования
        </h2>
        <img id="marker" src="./jen/heart.png.webp" />
      </div>
      <p>Для детей от 8 до 16 лет</p>
    </div>
    <div class="right_page1" style="width: 55%; height: 100vh; overflow: hidden;">
      <img 
        src="./jen/centralImg.webp" 
        alt="Центральное изображение" 
        onerror="this.onerror=null; this.src='./jen/centralImg.jpg';" 
        style="width: 100%; height: 100%; object-fit: cover;"
      >
    </div>
    <div>
      <div class="microsft">
        <img src="./jen/microsoft.png" />
        <p>Сертифицировано<br>Microsoft</p>
      </div>
      <img class="gamepad" src="./jen/Gamepad_better.png" />
    </div>
  </div>

  <!-- Основной контент -->
  <div class="page2" id="page2">
    <div class="card">
      <div class="textBlock">
        <div class="pageHeadDiv">
          <img src="./jen/code2.png" />
          <h3>Кто нас вдохновляет<br> и почему мы делаем игры?</h3>
          <img id="rocket" src="./jen/rocket_2.png.webp" />
        </div>
        <p>
          Основатели крупнейших IT компаний (Билл Гейтс, Марк Цукерберг и др.) начинали свой путь именно с игровой разработки.
        </p>
        <p>Создание игр - это увлекательный и творческий процесс, который развивает навыки решения сложных задач и логическое мышление. Каждый игровой проект заставляет продумывать новые механики, алгоритмы и пути решения проблем. Это лучшее направление для знакомства вашего ребенка с программированием!</p>
      </div>
      <div class="pacman">
        <div class="pacman-top"></div>
        <div class="pacman-bottom"></div>
        <div class="feed"></div>
      </div>
    </div>
  </div>

  <div class="page2" id="page3">
    <div class="card">
      <h3>Наши приоритеты</h3>
      <div class="priory">
        <div class="carousel">
          <div class="carousel-item">
            <img class="levitate" src="./jen/guy-programming.png" />
            <h5>Преподаватели, которые вдохновляют</h5>
            <p>
              Их любовь и знание предмета мотивируют учеников покорять новые вершины
            </p>
          </div>
          <div class="carousel-item">
            <img class="levitate" src="./jen/smartboy.png" />
            <h5>Обучение практическим навыкам</h5>
            <p>
              Наши курсы основаны на современных британских курсах по разработке игр от gamedev.tv
            </p>
          </div>
          <div class="carousel-item">
            <img class="levitate" src="./jen/Group.png" />
            <h5>Работа в мини-группах или индивидуально</h5>
            <p>
              Мы работаем только в мини-группах до 8 учеников, чтобы уделить внимание каждому
            </p>
          </div>
          <div class="carousel-item">
            <img class="levitate" src="./jen/camera.png" />
            <h5>Видеоуроки для закрепления материала</h5>
            <p>
              После каждого занятия мы высылаем видеоуроки с пройденным материалом и ДЗ
              </p>
          </div>
        </div>
      </div>
      <button>Подробнее</button>
    </div>
  </div>
  <div class="page2" id="page4">
    <h3>Наши курсы</h3>
    <div class="card">
      <div class="carousel">
        <div class="carousel-item">
          <img src="./jen/minecraft.png" alt="Курс">
          <h5>Программирование в Minecraft</h5>
        </div>
        <div class="carousel-item">
          <img src="./jen/roblox.png" alt="Курс">
          <h5>Создание игр в Roblox</h5>
        </div>
        <div class="carousel-item">
          <img src="./jen/unity.png" alt="Курс">
          <h5>Разработка на Unity</h5>
        </div>
      </div>
      <div id="robot"></div>
    </div>
    <div></div>
  </div>
  <div class="page2" id="page5">
    <div class="card">
      <h3>
        Не можете определиться с курсом?<br>
Оставьте заявку, мы вам перезвоним
и поможем выбрать подходящий курс
      </h3>
      <button>Оставить заявку</button>
    </div>
  </div>
  <div class="page2" id="page6">
    <div class="card">
      <h3>
        Наша команда
      </h3>      
      <div class="card">
        <div class="carousel">
          <div class="carousel-item revertable" data-back="Евгений работает в области разработки игр уже более 9 лет, а преподает разработку игр для детей более 7-ти лет. Он обожает Unity и язык программирования C#. В методические материалы он вложил всю свою душу и любовь к программированию.">
            <img src="./jen/evgen.jpg" />
            <h5>Евгений</h5>
            <p>
              Основатель, Unity разработчик, Создатель методических материалов<br>Выпускник МГТУ им. Н.Э. Баумана
            </p>
          </div>
          <div class="carousel-item revertable" data-back="Мартин является Fullstack и Python разработчиком более 7 лет.<br>Опыт преподавания детям 5 лет.<br>Язык программирования Python - его страсть, именно поэтому наш курс программирования на этом языке разработан Мартином. Также в нашей команде он отвечает за SMM и наши соц. сети.">
            <img src="./jen/martin.jpg" />
            <h5>Мартин</h5>
            <p>Основатель, Web разработчик, Работа над соц. сетями<br>Выпускник МГУ им. М.В. Ломоносова</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Пространство для прокрутки -->
  <div class="content-spacer"></div>

  <!-- Скрипт -->
<script type="importmap">
  {
    "imports": {
      "three": "https://spamigor.ru/library/threejs/build/three.module.js",
      "three/addons/": "https://spamigor.ru/library/threejs/examples/jsm/"
    }
  }
</script>
<script type="module" src="./jen/robot.js"></script>

<script>
  const page1 = document.getElementById('page1');
  const page2 = document.getElementById('page2');
  const page3 = document.getElementById('page3');
  const page4 = document.getElementById('page4');  
  const page5 = document.getElementById('page5');
  const page6 = document.getElementById('page6');
// Плавная последовательная анимация
const page2ShowStart   = 100;   // page2 появляется
const page2FadeInEnd   = 200;   // page2 полностью виден
const page2HideStart   = 550;   // page2 начинает исчезать
const page2FadeOutEnd  = 650;   // page2 исчезает

const page3ShowStart   = 600;   // page3 начинает появляться (перекрытие 50px)
const page3FadeInEnd   = 700;   // page3 полностью виден
const page3HideStart   = 1200;  // page3 начинает исчезать
const page3FadeOutEnd  = 1300;  // page3 исчезает

const page4ShowStart   = 1250;  // page4 появляется (начинается до конца page3)
const page4FadeInEnd   = 1350;  // page4 полностью виден

const page5ShowStart   = 1700;  // page5 начинает появляться
const page5FadeInEnd   = 1750;  // page5 полностью виден

const page6ShowStart   = 2000;  // page6 начинает появляться
const page6FadeInEnd   = 2100;  // page6 полностью виден

  var setScroll = (scr) => {
    console.log(scr)
    const scrollY = window.scrollY;
    if (scr < 0) scr = 0;
    if (Math.abs(scr - scrollY) > 20) {
      window.scrollTo(0, scrollY + (scr > scrollY ? 10 : -10));
      setTimeout(setScroll,20,scr)
    }
    else if (scrollY < 30) window.scrollTo(0,0);
  }

  function updatePages() {
    const scrollY = window.scrollY;

    // === Управление page1 (уезжает наверх) ===
    if (scrollY <= 0) {
      page1.style.transform = 'translateY(0)';
      page1.style.opacity = '1';
      page1.style.backdropFilter = 'blur(0px)';
    } else {
      const blurAmount = Math.min(scrollY * 0.03, 10);
      const opacity = Math.max(1 - scrollY * 0.008, 0);
      page1.style.transform = `translateY(-${scrollY * 2.5}px)`;
      page1.style.opacity = opacity;
      page1.style.backdropFilter = `blur(${blurAmount}px)`;
    }

    // === Управление page2 (появляется, потом исчезает) ===

    if (scrollY > page2ShowStart) {
      if (scrollY < page2HideStart) {
        page2.style.opacity = '1';
        page2.classList.add('show');
      } else if (scrollY >= page2HideStart) {
        const fadeOutProgress = Math.min((scrollY - page2HideStart) / (page2FadeOutEnd - page2HideStart), 1);
        page2.style.opacity = 1 - fadeOutProgress;
        if (fadeOutProgress === 1) {
          page2.classList.remove('show');
        }
      }
    } else {
      page2.style.opacity = '0';
      page2.classList.remove('show');
    }

    // === Управление page3 (появляется после page2) ===

    if (scrollY > page3ShowStart) {
      let opacity = 1;

      // Появление
      if (scrollY <= page3FadeInEnd) {
        opacity = (scrollY - page3ShowStart) / (page3FadeInEnd - page3ShowStart);
      }
      // Исчезание при появлении page4
      else if (scrollY >= page3HideStart) {
        opacity = 1 - (scrollY - page3HideStart) / (page3FadeOutEnd - page3HideStart);
        opacity = Math.max(opacity, 0);
      }

      page3.style.opacity = opacity;
      if (opacity > 0) {
        page3.classList.add('show');
      } else {
        page3.classList.remove('show');
      }
    } else {
      page3.style.opacity = '0';
      page3.classList.remove('show');
    }

    // === Управление page4 (появляется после page3) ===

    if (scrollY > page4ShowStart) {
      let opacity = 1;

      // Появление
      if (scrollY <= page4FadeInEnd) {
        opacity = (scrollY - page4ShowStart) / (page4FadeInEnd - page4ShowStart);
      }
      // Исчезание при появлении page5
      else if (scrollY >= page5ShowStart) {
        opacity = 1 - (scrollY - page5ShowStart) / (page5FadeInEnd - page5ShowStart);
        opacity = Math.max(opacity, 0);
      }

      page4.style.opacity = opacity;
      if (opacity > 0) {
        page4.classList.add('show');
      } else {
        page4.classList.remove('show');
      }
    } else {
      page4.style.opacity = '0';
      page4.classList.remove('show');
    }

    // === Управление page5 (появляется после page4, исчезает при page6) ===
    if (scrollY > page5ShowStart) {
      let opacity = 1;

      // Появление
      if (scrollY <= page5FadeInEnd) {
        opacity = (scrollY - page5ShowStart) / (page5FadeInEnd - page5ShowStart);
      }
      // Исчезание при появлении page6
      else if (scrollY >= page6ShowStart) {
        opacity = 1 - (scrollY - page6ShowStart) / (page6FadeInEnd - page6ShowStart);
        opacity = Math.max(opacity, 0);
      }

      page5.style.opacity = opacity;
      if (opacity > 0) {
        page5.classList.add('show');
      } else {
        page5.classList.remove('show');
      }
    } else {
      page5.style.opacity = '0';
      page5.classList.remove('show');
    }

    // === Управление page6 (появляется после page5) ===
    if (scrollY > page6ShowStart) {
      const fadeInProgress = Math.min(
        (scrollY - page6ShowStart) / (page6FadeInEnd - page6ShowStart),
        1
      );
      page6.style.opacity = fadeInProgress;
      if (fadeInProgress > 0) {
        page6.classList.add('show');
      } else {
        page6.classList.remove('show');
      }
    } else {
      page6.style.opacity = '0';
      page6.classList.remove('show');
    }
  }
let touchStartY = 0;

  // При касании экрана запоминаем начальную координату Y
  function handleTouchStart(event) {
    event.preventDefault(); // Запрещает стандартное действие скролла
    touchStartY = event.touches[0].clientY;
  }

  // При отпускании пальца проверяем направление свайпа
  function handleTouchEnd(event) {
    event.preventDefault(); // Запрещает стандартное действие скролла
    const touchEndY = event.changedTouches[0].clientY;
    const diff = touchStartY - touchEndY;

    // Если палец двигался вниз (начало > конец), то это свайп вниз
    if (diff < -50) { // -50 — порог срабатывания (в пикселях)
      setScroll((Math.floor(window.scrollY/300) - 1)*300)
    }
    else if (diff > 50) { // 50 — порог срабатывания (в пикселях)
      setScroll((Math.floor(window.scrollY/300) + 1)*300)
    }
  }

  // Добавляем события
  /*document.addEventListener('touchstart', handleTouchStart, { passive: true });
  document.addEventListener('touchend', handleTouchEnd, { passive: true });
  document.addEventListener('touchmove', function(event) {
    event.preventDefault(); // Запрещает стандартное действие скролла
  });*/
  window.addEventListener('scroll', updatePages);
  window.addEventListener('load', updatePages);

  document.querySelectorAll('.carousel').forEach(carousel => {
  let isDown = false;
  let startX;
  let scrollLeft;
  let isDragging = false; // Флаг: точно ли тянем, а не просто касание

  // Нажатие
  carousel.addEventListener('mousedown', startDrag);
  carousel.addEventListener('touchstart', startDrag, { passive: false });

  // Движение
  carousel.addEventListener('mousemove', drag);
  carousel.addEventListener('touchmove', drag, { passive: false });

  // Отпускание
  carousel.addEventListener('mouseup', endDrag);
  carousel.addEventListener('mouseleave', endDrag);
  carousel.addEventListener('touchend', endDrag);

  function startDrag(e) {
    isDown = true;
    isDragging = false;
    startX = e.type === 'touchstart' ? e.touches[0].pageX : e.pageX;
    scrollLeft = carousel.scrollLeft;
    carousel.classList.add('active');
  }

  function drag(e) {
    if (!isDown) return;

    const x = e.type === 'touchmove' ? e.touches[0].pageX : e.pageX;
    const y = e.type === 'touchmove' ? e.touches[0].pageY : e.pageY;

    // Определяем начальную точку
    const dx = Math.abs(x - startX);
    const dy = Math.abs(y - (e.type === 'touchmove' ? e.touches[0].clientY : e.clientY));

    // Если вертикальное движение больше горизонтального — это не drag карусели, а скролл страницы
    if (dy > dx) {
      isDown = false; // Отключаем обработку drag
      return; // Не блокируем, пропускаем событие
    }

    // Если движение достаточно большое по X — это drag
    if (dx > 5) {
      isDragging = true;
      e.preventDefault(); // Только если явно тянем по X
    }

    const walk = (x - startX) * 1.5;
    carousel.scrollLeft = scrollLeft - walk;
  }

  function endDrag() {
    isDown = false;
    isDragging = false;
    carousel.classList.remove('active');
  }
});
document.getElementById('about').addEventListener('click', function() {
  setScroll(300)
})
document.getElementById('courses').addEventListener('click', function() {
  setScroll(1400)
})
document.getElementById('team').addEventListener('click', function() {
  setScroll(2000)
})
document.getElementById('contact').addEventListener('click', function() {
  setScroll(2000)
})
document.getElementById('topLogo').addEventListener('click', function() {
  setScroll(0)
})

  // --- flip cards for .carousel-item.revertable ---
const revert = function() {
    const items = document.querySelectorAll('.carousel-item.revertable');
    items.forEach(item => {
      // если уже обработан — пропускаем
      if (item.dataset._flipInit) return;
      item.dataset._flipInit = '1';

      const inner = document.createElement('div');
      inner.className = 'revertable-inner';

      const front = document.createElement('div');
      front.className = 'revertable-front';

      const back = document.createElement('div');
      back.className = 'revertable-back';

      // переместить все исходные child'ы (кроме тех, что уже добавлены)
      while (item.firstChild) {
        front.appendChild(item.firstChild);
      }

      const backHtml = item.getAttribute('data-back') || 'Информация';
      back.innerHTML = '<div>' + backHtml + '</div>';

      inner.appendChild(front);
      inner.appendChild(back);
      item.appendChild(inner);

      item.setAttribute('tabindex', '0');
      item.setAttribute('role', 'button');

      // простая и надёжная детекция клика (отличаем от перетаскивания)
      let pointerDown = null;
      let moved = false;

      item.addEventListener('pointerdown', (e) => {
        pointerDown = { x: e.clientX, y: e.clientY, t: Date.now() };
        moved = false;
        item.setPointerCapture(e.pointerId);
      });

      item.addEventListener('pointermove', (e) => {
        if (!pointerDown) return;
        const dx = Math.abs(e.clientX - pointerDown.x);
        const dy = Math.abs(e.clientY - pointerDown.y);
        if (dx > 8 || dy > 8) moved = true;
      });

      item.addEventListener('pointerup', (e) => {
        if (!pointerDown) return;
        const dt = Date.now() - pointerDown.t;
        // считаем кликом, если не было значимого движения и не очень долгий удерж
        if (!moved && dt < 600) {
          item.classList.toggle('flipped');
        }
        try { item.releasePointerCapture(e.pointerId); } catch (err) {}
        pointerDown = null;
      });

      // отмена (например pointercancel)
      item.addEventListener('pointercancel', () => {
        pointerDown = null;
        moved = false;
      });

      // клавиатура
      item.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          item.classList.toggle('flipped');
        }
        if (e.key === 'Escape') {
          item.classList.remove('flipped');
        }
      });
    });
  };
  revert();
</script>
</body>
</html>
